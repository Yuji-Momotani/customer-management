# クイックスタート: LINE LIFF 予約システム

**目的**: LINE LIFF予約システムのエンドツーエンドユーザーシナリオの検証  
**前提条件**: Next.jsアプリが動作する開発環境、テストデータベースがシード済み

## テストシナリオ

### シナリオ1: サービス閲覧と予約（ハッピーパス）

**前提条件**: ユーザーがLIFFアプリをLINEで開く
**実行時**: ユーザーが予約フローを進む
**期待結果**: 予約が作成され、LINEで確認が送信される

**手順**:
1. LINEシミュレーター/デバイスでLIFFアプリを開く
2. LINEユーザー認証が動作することを確認
3. 利用可能なサービスを閲覧 - 「アクセスバース」「霊視オラクルリーディング」「エネルギークリアリング」サービスが表示されるべき
4. サービスを選択し、今日の利用可能な時間枠を表示
5. 利用可能な時間枠を選択
6. 顧客詳細で予約フォームを記入
7. 予約を確定
8. 予約参照番号が生成されることを確認
9. LINE通知が送信されることを確認
10. 「マイ予約」セクションに予約が表示されることを確認

**期待される結果**:
- サービス一覧がアクティブなサービスと共に読み込まれる
- 時間枠は利用可能なスロットのみを表示
- 予約フォームが必須フィールドを検証
- 予約ステータスがCONFIRMEDになる
- LINE通知に予約参照番号が含まれる
- ユーザーが予約詳細を表示できる

### シナリオ2: 既存予約の表示とキャンセル

**前提条件**: ユーザーが既存の確定予約を持つ
**実行時**: ユーザーが予約をキャンセルする
**期待結果**: 予約ステータスが変更され、時間枠が利用可能になる

**手順**:
1. LIFFアプリを開き「マイ予約」に移動
2. 既存のCONFIRMED予約を選択
3. 「予約をキャンセル」ボタンをタップ
4. ダイアログでキャンセルを確認
5. 予約ステータスがCANCELLEDに変更されることを確認
6. 時間枠が再び利用可能になることを確認
7. LINEでキャンセル通知が送信されることを確認

**期待される結果**:
- 予約一覧がユーザーの予約を表示
- キャンセルボタンはキャンセルポリシー内でのみ利用可能
- UIでステータスが即座に更新される
- 時間枠が利用可能スロットに再表示される
- LINE通知でキャンセルを確認

### シナリオ3: 予約競合の処理

**前提条件**: 2人のユーザーが同じ時間枠を同時に予約しようとする
**実行時**: 2番目のユーザーが予約確定を試みる
**期待結果**: システムがダブルブッキングを防ぐ

**手順**:
1. ユーザーAが時間枠を選択し予約プロセスを開始
2. ユーザーBが並行して同じ時間枠を選択
3. ユーザーAが先に予約を完了
4. ユーザーBが予約確定を試みる
5. ユーザーBが「時間枠は利用できません」エラーを受信することを確認
6. ユーザーBが他の利用可能な時間枠を選択できる

**期待される結果**:
- 時間枠に対して1つの予約のみが作成される
- エラーメッセージが明確で有用
- UIが利用可能な時間枠を更新
- 部分的/孤立した予約が作成されない

### シナリオ4: モバイルレスポンシブインターフェース

**前提条件**: ユーザーがモバイルデバイスでLIFFアプリにアクセス
**実行時**: ユーザーが予約インターフェースと対話
**期待結果**: すべての機能がモバイルでスムーズに動作

**手順**:
1. 複数のモバイル画面サイズでテスト
2. 時間枠選択がタッチフレンドリーであることを確認
3. フォーム入力がモバイルキーボードで動作することを確認
4. ボタンが適切なサイズであることを確認
5. 画面間のナビゲーションをテスト
6. テキストと日付の可読性を確認

**期待される結果**:
- インターフェースが画面サイズに適応
- タッチターゲットが最低44px
- ズームなしでテキストが読める
- フォームがモバイル入力方法で動作
- ナビゲーションが直感的

### シナリオ5: LINE統合機能

**前提条件**: LIFFアプリが適切に設定されている
**実行時**: ユーザーがLINE固有の機能と対話
**期待結果**: LINE統合が期待通りに動作

**手順**:
1. アプリ開始時のLIFF初期化を確認
2. LINEユーザープロフィール取得をテスト
3. 通知用のLINEメッセージングAPIを確認
4. 特定の予約への深いリンクをテスト
5. LIFF共有機能をテスト（実装されている場合）

**期待される結果**:
- ユーザープロフィールが自動で読み込まれる
- 通知がLINEチャットに表示される
- 深いリンクが正しく動作
- 共有機能が適切なLINEメッセージを作成

## パフォーマンス検証

**負荷テスト**:
- 50人の同時ユーザーがサービスを閲覧
- 20の同時予約試行
- APIコールの応答時間が300ms未満

**ストレステスト**:
- 複数ユーザーが同じ時間枠を予約
- 画面間の迅速なナビゲーション
- ネットワーク中断シナリオ

## データ検証

**データベースチェック**:
- ダブルブッキングが存在しないことを確認
- 予約ステータスの一貫性を確認
- 時間枠の利用可能性更新を確認
- データ整合性制約を検証

**APIテスト**:
- すべてのエンドポイントが適切なステータスコードを返す
- エラーレスポンスに有用なメッセージが含まれる
- リクエスト検証が正しく動作
- 認証が適切に強制されている

## ロールバック計画

重要な問題が発見された場合:
1. 具体的な失敗シナリオを文書化
2. 必要に応じて以前の安定版に戻す
3. 開発環境で問題を修正
4. クイックスタート検証を再実行

## 成功基準

✅ 5つのテストシナリオすべてが正常に完了  
✅ パフォーマンス目標を達成  
✅ モバイルインターフェースが完全に機能  
✅ LINE統合が動作  
✅ データ整合性の問題なし  
✅ エラーハンドリングが優雅で情報的

**推定時間**: 完全な検証に2-3時間