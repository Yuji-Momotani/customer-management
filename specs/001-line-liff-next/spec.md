# 機能仕様書: LINE LIFF 予約システム

**機能ブランチ**: `001-line-liff-next`  
**作成日**: 2025-09-22  
**ステータス**: ドラフト  
**入力**: ユーザー説明: "Line Liffアプリで予約システムを開発したい"

## 実行フロー (main)
```
1. 入力からユーザー説明を解析
   → ユーザーはLINE LIFFアプリの予約システムを開発したい
2. 説明から主要概念を抽出
   → アクター: LINEユーザー、事業者/サービス提供者
   → アクション: 予約作成、予約管理、空き状況確認
   → データ: 予約詳細、ユーザー情報、時間枠、サービス
   → 制約: LINE LIFFプラットフォームとの統合
3. 不明確な点について:
   → [要明確化: どのような種類のサービス/事業が対象か？]
   → [要明確化: どのようなユーザーロールが存在するか（顧客のみ、または管理者/スタッフも）？]
   → [要明確化: 予約制約は何か（時間枠、定員、事前通知）？]
4. ユーザーシナリオ＆テストセクションを記入
   → 主要フロー: ユーザーが閲覧 → サービス選択 → 時間枠予約 → 確認
5. 機能要件を生成
   → LINE統合を含む主要予約機能
6. 主要エンティティを特定
   → 予約、ユーザー、サービス、時間枠
7. レビューチェックリストを実行
   → 警告 "仕様に不確実性あり - 複数の明確化が必要"
8. 戻り値: 成功（明確化後、計画準備完了）
```

---

## ⚡ 簡易ガイドライン
- ✅ ユーザーが必要とするものと理由に焦点を当てる
- ❌ 実装方法を避ける（技術スタック、API、コード構造なし）
- 👥 開発者ではなく、ビジネス関係者向けに記述

---

## ユーザーシナリオ＆テスト *(必須)*

### 主要ユーザーストーリー
LINEユーザーがLIFFアプリの`/reservation`画面を開いてヒーリングサービスの予約を取ります。3つのサービス（アクセスバース、霊視オラクルリーディング、エネルギークリアリング）から選択し、時間とカレンダーで希望日時を選択し、予約を確定します。LINEを通じて確認を受け取り、アプリで予約を管理できます。

### 受け入れシナリオ
1. **前提条件** ユーザーが`/reservation`画面を開く、**実行時** サービス一覧を閲覧する、**期待結果** アクセスバース、霊視オラクルリーディング、エネルギークリアリングが料金と共に表示される
2. **前提条件** ユーザーがサービスを選択する、**実行時** 時間オプションを選ぶ、**期待結果** 選択したサービスの時間と料金オプションが表示される（エネルギークリアリングは+1000円）
3. **前提条件** ユーザーが時間を選択する、**実行時** カレンダーで日時を選択する、**期待結果** 利用可能な日時が表示され選択可能
4. **前提条件** ユーザーが予約詳細を入力する、**実行時** 予約送信ボタンを押す、**期待結果** 予約が作成されLINE通知が送信される
5. **前提条件** ユーザーが既存の予約を持つ、**実行時** アプリを開く、**期待結果** 予約を閲覧・管理できる

### エッジケース
- 予約過程中にユーザーのLINEセッションが期限切れになった場合はどうなるか？
- システムはダブルブッキングの試行をどう処理するか？
- 予約過程の途中でユーザーがアプリを閉じた場合どうなるか？
- ノーショーや遅いキャンセルはどう管理されるか？

## 要件 *(必須)*

### 機能要件
- **FR-001**: システムは現在の予約状況と共に利用可能なサービスを表示しなければならない
- **FR-002**: システムはユーザーがサービス予約のための時間枠を選択できるようにしなければならない
- **FR-003**: ユーザーは必要な予約情報を提供できなければならない [要明確化: どのような情報が必要か？]
- **FR-004**: システムは予約を確認し予約参照番号を生成しなければならない
- **FR-005**: システムはLINEメッセージ経由で予約確認を送信しなければならない
- **FR-006**: ユーザーは既存の予約を閲覧できなければならない
- **FR-007**: ユーザーは予約をキャンセルまたは変更できなければならない [要明確化: どの時間枠と条件内で？]
- **FR-008**: システムは時間枠のダブルブッキングを防がなければならない
- **FR-009**: システムはLINEユーザー認証と統合しなければならない
- **FR-010**: システムは処理しなければならない [要明確化: どのユーザーロール - 顧客のみ、またはスタッフ/管理者インターフェースも？]
- **FR-011**: システムはヒーリングサービス（アクセスバース、霊視オラクルリーディング、エネルギークリアリング）を管理しなければならない
- **FR-012**: システムは強制しなければならない [要明確化: 予約ルール - 事前通知、キャンセルポリシー、定員制限？]

### 主要エンティティ *(機能がデータを含む場合に含める)*
- **予約**: ユーザー、サービス、時間枠、ステータス、予約詳細を含む予約を表す
- **ユーザー**: LINEユーザー情報と予約履歴
- **サービス**: 期間と空き状況ルールを持つ予約可能なサービス/予約タイプ
- **時間枠**: 定員とサービス関連付けを持つ利用可能な予約期間
- **事業者/提供者**: [要明確化: マルチテナントの場合、サービス提供者の詳細を表す]

---

## レビュー＆受け入れチェックリスト
*ゲート: main()実行中に自動チェックが実行される*

### コンテンツ品質
- [x] 実装詳細なし（言語、フレームワーク、API）
- [x] ユーザー価値とビジネスニーズに焦点
- [x] 非技術的な関係者向けに記述
- [x] すべての必須セクションが完了

### 要件完全性
- [ ] [要明確化]マーカーが残っていない
- [ ] 要件がテスト可能で曖昧でない
- [ ] 成功基準が測定可能
- [ ] スコープが明確に境界設定
- [ ] 依存関係と前提条件が特定

---

## 実行ステータス
*main()処理中に更新*

- [x] ユーザー説明解析済み
- [x] 主要概念抽出済み
- [x] 曖昧性マーク済み
- [x] ユーザーシナリオ定義済み
- [x] 要件生成済み
- [x] エンティティ特定済み
- [ ] レビューチェックリスト合格

---